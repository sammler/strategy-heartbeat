version: '3.3'

services:

  rabbitmq:
    image: sammlerio/rabbitmq:0.1.3
    container_name: rabbitmq
    # Seems to throw an error on Mac-OS
#    volumes:
#      - ./.data/rabbitmq/data:/var/lib/rabbitmq
#      - ./.data/rabbitmq/log:/var/log/rabbitmq/sammler
    ports:
      - "15672:15672"
      - "5672:5672"
    environment:
      - RABBITMQ_NODENAME=sammler
      - DOCKER_LABELS=true
      - LOGSPOUT=ignore
    labels:
      - io.sammler.env=DEV
      - io.sammler.service=rabbitmq
    depends_on:
      - logstash
    restart: always

  log-service:
    image: sammlerio/log-service:0.0.5@sha256:53e76a8ac70ed03fe26da78eed58870d267ee801bcc8edf5facded195508ff7b
    container_name: log-service
    environment:
      - NOVE_ENV=production
      - SERVICE_NAME=log-service
      - MONG

  strategy-heartbeat:
    image: sammlerio/strategy-heartbeat:0.1.0@sha256:ff32c8b2a6694ad5b5e13b5c15665eb6310fd0889078ec8384562daf63db3fd2
    container_name: strategy-heartbeat
    environment:
      - NODE_ENV=production
      - SERVICE_NAME=strategy-heartbeat
      - RABBITMQ_URI=amqp://guest:guest@s5r-rabbitmq:5672
      - LOG_SERVICE_URI=http://log-service:3004
    volumes:
      - ./src:/opt/strategy-heartbeat
